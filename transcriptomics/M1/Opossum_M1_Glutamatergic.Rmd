---
title: "Opossum M1 GABAergic"
output: html_notebook
---

```{r}

library(Seurat)
library(reticulate)
library(arrow)
library(ggplot2)
library(dplyr)
library(SeuratDisk)
obj.opossum.glutamatergic <- LoadH5Seurat("E:/Opossum_M1/seurat/opossum_m1_glutamatergic.h5Seurat")

```


```{r}

obj.opossum.glutamatergic <- FindVariableFeatures(obj.opossum.glutamatergic, selection.method = "vst", nfeatures = 3000)
all.genes <- rownames(obj.opossum.glutamatergic)
obj.opossum.glutamatergic <- ScaleData(obj.opossum.glutamatergic, features = all.genes)
obj.opossum.glutamatergic <- RunPCA(obj.opossum.glutamatergic, features = VariableFeatures(object = obj.opossum.glutamatergic))
ElbowPlot(obj.opossum.glutamatergic, ndims = 50)

```


```{r}

obj.opossum.glutamatergic <- FindNeighbors(obj.opossum.glutamatergic, dims = 1:30)
obj.opossum.glutamatergic <- FindClusters(obj.opossum.glutamatergic, resolution = 1, algorithm = 4, method = "igraph")
obj.opossum.glutamatergic <- RunUMAP(obj.opossum.glutamatergic, dims = 1:30, method="umap-learn")

```


```{r}

DimPlot(obj.opossum.glutamatergic, reduction = "umap", label = TRUE, raster = FALSE) + NoLegend() + xlim(-12, 15) + ylim(-12, 15) + coord_equal()
DimPlot(obj.opossum.glutamatergic, reduction = "umap", group.by = "sample", raster = FALSE) + xlim(-12, 15) + ylim(-12, 15) + coord_equal()
DimPlot(obj.opossum.glutamatergic, reduction = "umap", group.by = "predicted_doublets", raster = FALSE) + xlim(-12, 15) + ylim(-12, 15) + coord_equal()

```


```{r}

FeaturePlot(obj.opossum.glutamatergic, reduction = "umap", features = c("Cux2")) + xlim(-15, 15) + ylim(-15, 15) + coord_equal()
FeaturePlot(obj.opossum.glutamatergic, reduction = "umap", features = c("Rorb")) + xlim(-15, 15) + ylim(-15, 15) + coord_equal()
FeaturePlot(obj.opossum.glutamatergic, reduction = "umap", features = c("Nxph1")) + xlim(-15, 15) + ylim(-15, 15) + coord_equal()
FeaturePlot(obj.opossum.glutamatergic, reduction = "umap", features = c("Foxp2")) + xlim(-15, 15) + ylim(-15, 15) + coord_equal()
FeaturePlot(obj.opossum.glutamatergic, reduction = "umap", features = c("Inpp4b")) + xlim(-15, 15) + ylim(-15, 15) + coord_equal()
FeaturePlot(obj.opossum.glutamatergic, reduction = "umap", features = c("Chrm1")) + xlim(-15, 15) + ylim(-15, 15) + coord_equal()
FeaturePlot(obj.opossum.glutamatergic, reduction = "umap", features = c("Chrm2")) + xlim(-15, 15) + ylim(-15, 15) + coord_equal()
FeaturePlot(obj.opossum.glutamatergic, reduction = "umap", features = c("Chrm3")) + xlim(-15, 15) + ylim(-15, 15) + coord_equal()
FeaturePlot(obj.opossum.glutamatergic, reduction = "umap", features = c("Chrm4")) + xlim(-15, 15) + ylim(-15, 15) + coord_equal()
FeaturePlot(obj.opossum.glutamatergic, reduction = "umap", features = c("Chrm5")) + xlim(-15, 15) + ylim(-15, 15) + coord_equal()
FeaturePlot(obj.opossum.glutamatergic, reduction = "umap", features = c("Chrna1")) + xlim(-15, 15) + ylim(-15, 15) + coord_equal()
FeaturePlot(obj.opossum.glutamatergic, reduction = "umap", features = c("Chrna2")) + xlim(-15, 15) + ylim(-15, 15) + coord_equal()
FeaturePlot(obj.opossum.glutamatergic, reduction = "umap", features = c("Chrna3")) + xlim(-15, 15) + ylim(-15, 15) + coord_equal()
FeaturePlot(obj.opossum.glutamatergic, reduction = "umap", features = c("Chrna4")) + xlim(-15, 15) + ylim(-15, 15) + coord_equal()
FeaturePlot(obj.opossum.glutamatergic, reduction = "umap", features = c("Chrna5")) + xlim(-15, 15) + ylim(-15, 15) + coord_equal()

```


```{r}

obj.opossum.glutamatergic <- FindClusters(obj.opossum.glutamatergic, resolution = 0.5, algorithm = 4, method = "igraph")
obj.opossum.glutamatergic <- FindClusters(obj.opossum.glutamatergic, resolution = 1.5, algorithm = 4, method = "igraph")
obj.opossum.glutamatergic <- FindClusters(obj.opossum.glutamatergic, resolution = 2, algorithm = 4, method = "igraph")
obj.opossum.glutamatergic <- FindClusters(obj.opossum.glutamatergic, resolution = 2.5, algorithm = 4, method = "igraph")
obj.opossum.glutamatergic <- FindClusters(obj.opossum.glutamatergic, resolution = 3, algorithm = 4, method = "igraph")

```


```{r}

DimPlot(obj.opossum.glutamatergic, reduction = "umap", group.by="RNA_snn_res.0.5", label = TRUE, raster = FALSE) + NoLegend() + xlim(-12, 15) + ylim(-12, 15) + coord_equal()
DimPlot(obj.opossum.glutamatergic, reduction = "umap", group.by="RNA_snn_res.1", label = TRUE, raster = FALSE) + NoLegend() + xlim(-12, 15) + ylim(-12, 15) + coord_equal()
DimPlot(obj.opossum.glutamatergic, reduction = "umap", group.by="RNA_snn_res.1.5", label = TRUE, raster = FALSE) + NoLegend() + xlim(-12, 15) + ylim(-12, 15) + coord_equal()
DimPlot(obj.opossum.glutamatergic, reduction = "umap", group.by="RNA_snn_res.2", label = TRUE, raster = FALSE) + NoLegend() + xlim(-12, 15) + ylim(-12, 15) + coord_equal()
DimPlot(obj.opossum.glutamatergic, reduction = "umap", group.by="RNA_snn_res.2.5", label = TRUE, raster = FALSE) + NoLegend() + xlim(-12, 15) + ylim(-12, 15) + coord_equal()
DimPlot(obj.opossum.glutamatergic, reduction = "umap", group.by="RNA_snn_res.3", label = TRUE, raster = FALSE) + NoLegend() + xlim(-12, 15) + ylim(-12, 15) + coord_equal()

```


```{r}

# SaveH5Seurat(obj.opossum.glutamatergic, "E:/Opossum_M1/seurat/opossum_m1_glutamatergic.h5seurat", overwrite = TRUE, verbose = TRUE)

```

